# 定时任务配置说明

## 命令
```bash
cd /www/wwwroot/back.kkttrading.com && /www/server/php/81/bin/php think settle:orders
```

## Crontab 配置示例

### 方式1：每分钟执行（推荐）
```bash
* * * * * cd /www/wwwroot/back.kkttrading.com && /www/server/php/81/bin/php think settle:orders >> /tmp/settle_orders.log 2>&1
```

### 方式2：每30秒执行（需要特殊技巧）
```bash
* * * * * cd /www/wwwroot/back.kkttrading.com && /www/server/php/81/bin/php think settle:orders >> /tmp/settle_orders.log 2>&1
* * * * * sleep 30 && cd /www/wwwroot/back.kkttrading.com && /www/server/php/81/bin/php think settle:orders >> /tmp/settle_orders.log 2>&1
```

## 注意事项

1. **PHP 路径**：确保 `/www/server/php/81/bin/php` 路径正确
2. **项目路径**：确保 `/www/wwwroot/back.kkttrading.com` 是项目根目录
3. **权限**：确保 PHP 进程有读写权限（数据库、文件系统）
4. **日志**：建议添加日志输出以便排查问题
5. **进程锁**：脚本自带进程锁机制，防止重复执行

## 工作原理

- 脚本运行 60 秒，每秒检查一次到期订单
- 即使 crontab 设置为每分钟执行，也不会有冲突（进程锁保护）
- 实际检查频率取决于 crontab 设置和执行耗时


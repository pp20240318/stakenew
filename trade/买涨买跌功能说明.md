# 买涨买跌功能说明

## ✨ 新增功能

已在市场详情页添加**买涨买跌**交易功能，用户点击按钮后弹出交易弹窗。

## 🎯 功能特性

### 1. 买涨买跌按钮
- **位置**: 图表下方
- **样式**: 
  - 买涨：绿色渐变按钮 📈
  - 买跌：红色渐变按钮 📉
- **交互**: 点击后弹出交易弹窗

### 2. 交易弹窗
点击买涨或买跌按钮后，从底部滑出弹窗，包含：

#### 弹窗内容
1. **币种信息**
   - 币种符号（如 BTC）
   - 当前价格

2. **时间选择**
   - 30S (80%)
   - M1 (81%)
   - M2 (82%)
   - M3 (83%)

3. **金额选择**
   - 预设金额：$10, $30, $50, $100
   - 自定义金额输入框

4. **确认按钮**
   - 显示选中的交易类型和金额
   - 买涨：绿色按钮
   - 买跌：红色按钮

## 📱 使用流程

### 用户操作步骤

1. **选择方向**
   ```
   点击 [买涨] 或 [买跌] 按钮
   ```

2. **弹窗打开**
   ```
   从底部滑出交易弹窗
   显示当前币种和价格
   ```

3. **选择时间**
   ```
   点击时间选项：30S / M1 / M2 / M3
   选中项高亮显示（蓝色背景）
   ```

4. **选择金额**
   ```
   方式1: 点击预设金额 ($10 / $30 / $50 / $100)
   方式2: 在自定义输入框输入金额
   ```

5. **确认交易**
   ```
   点击 [确认买涨 $XX] 或 [确认买跌 $XX]
   提交订单
   ```

## 💻 代码实现

### 数据结构

```javascript
data() {
  return {
    // 交易弹窗相关
    showTradeModal: false,     // 是否显示弹窗
    tradeType: 'up',           // 交易类型: 'up' 买涨, 'down' 买跌
    customAmount: '',          // 自定义金额
    
    // 时间选项
    selectedTradeTime: '30S',
    tradeTimeOptions: [
      { label: '30S', value: '30S', rate: '80%' },
      { label: 'M1', value: 'M1', rate: '81%' },
      { label: 'M2', value: 'M2', rate: '82%' },
      { label: 'M3', value: 'M3', rate: '83%' }
    ],
    
    // 金额选项
    selectedAmount: 10,
    amountOptions: [10, 30, 50, 100]
  }
}
```

### 核心方法

#### 1. 打开弹窗
```javascript
openTradeModal(type) {
  this.tradeType = type;        // 'up' 或 'down'
  this.showTradeModal = true;
  this.customAmount = '';
}
```

#### 2. 关闭弹窗
```javascript
closeTradeModal() {
  this.showTradeModal = false;
}
```

#### 3. 选择时间
```javascript
selectTradeTime(value) {
  this.selectedTradeTime = value;
}
```

#### 4. 选择金额
```javascript
selectAmount(amount) {
  this.selectedAmount = amount;
  this.customAmount = '';  // 清空自定义输入
}
```

#### 5. 自定义金额输入
```javascript
onCustomAmountInput(e) {
  this.customAmount = e.detail.value;
  this.selectedAmount = 0;  // 清除预设选择
}
```

#### 6. 确认交易
```javascript
confirmModalTrade() {
  const amount = this.customAmount || this.selectedAmount;
  
  // 验证金额
  if (!amount || amount <= 0) {
    uni.showToast({
      title: '请输入有效金额',
      icon: 'none'
    });
    return;
  }
  
  // 验证登录
  if (!this.userId) {
    uni.showToast({
      title: '请先登录',
      icon: 'none'
    });
    return;
  }
  
  // 执行交易
  this.executeTrade(this.tradeType, amount);
  this.closeTradeModal();
}
```

#### 7. 执行交易（待实现）
```javascript
executeTrade(type, amount) {
  uni.showLoading({
    title: '提交中...'
  });
  
  // TODO: 调用实际的交易 API
  // 示例：
  // api.createOrder({
  //   symbol: this.tradingSymbol,
  //   type: type,  // 'up' 或 'down'
  //   amount: amount,
  //   duration: this.selectedTradeTime
  // }).then(res => {
  //   uni.hideLoading();
  //   uni.showToast({
  //     title: '订单已提交',
  //     icon: 'success'
  //   });
  // }).catch(err => {
  //   uni.hideLoading();
  //   uni.showToast({
  //     title: '提交失败',
  //     icon: 'none'
  //   });
  // });
  
  setTimeout(() => {
    uni.hideLoading();
    uni.showToast({
      title: `${type === 'up' ? '买涨' : '买跌'}订单已提交`,
      icon: 'success'
    });
  }, 1000);
}
```

## 🎨 样式设计

### 按钮样式
- **买涨按钮**: 绿色渐变 + 阴影
- **买跌按钮**: 红色渐变 + 阴影
- **点击效果**: 缩放动画

### 弹窗样式
- **背景**: 半透明黑色遮罩
- **内容**: 从底部滑入动画
- **圆角**: 顶部圆角 32rpx
- **颜色**: 深色主题 (#2C2C2C)

### 选项样式
- **默认**: 深色背景 (#1A1A1A)
- **选中**: 蓝色渐变背景
- **过渡**: 平滑动画效果

## 🔧 待集成 API

需要实现以下 API 接口：

### 1. 创建订单
```javascript
POST /api/orders/create
{
  "symbol": "BTCUSDT",
  "type": "up",        // 'up' 或 'down'
  "amount": 100,
  "duration": "30S",   // '30S', 'M1', 'M2', 'M3'
  "userId": 123
}
```

### 2. 响应格式
```javascript
{
  "code": 200,
  "message": "订单创建成功",
  "data": {
    "orderId": "ORD123456",
    "status": "pending",
    "createTime": "2025-11-10 22:00:00"
  }
}
```

## 📋 TODO 清单

- [ ] 集成实际的交易 API
- [ ] 添加余额检查
- [ ] 添加订单历史记录
- [ ] 添加实时盈亏计算
- [ ] 添加订单状态更新
- [ ] 添加交易限制（最小/最大金额）
- [ ] 添加风险提示
- [ ] 添加交易确认二次确认

## 🎯 用户体验优化

### 已实现
- ✅ 流畅的弹窗动画
- ✅ 清晰的视觉反馈
- ✅ 直观的操作流程
- ✅ 响应式布局

### 可优化
- 添加震动反馈
- 添加声音提示
- 添加交易成功动画
- 添加实时收益显示

## 📱 测试建议

### 功能测试
1. 点击买涨按钮 → 弹窗打开
2. 点击买跌按钮 → 弹窗打开
3. 选择不同时间选项 → 高亮切换
4. 选择不同金额选项 → 高亮切换
5. 输入自定义金额 → 预设选项取消
6. 点击确认 → 提交订单
7. 点击关闭/遮罩 → 弹窗关闭

### 边界测试
1. 未登录状态 → 提示登录
2. 金额为0 → 提示无效
3. 金额为负数 → 提示无效
4. 未选择时间 → 使用默认值
5. 未选择金额 → 提示选择

## 📞 技术支持

如需修改或扩展功能，请参考：
- 组件文件: `pages/market/detail.vue`
- 样式定义: 文件末尾 `<style>` 部分
- API 接口: `utils/api.js`

---

**创建时间**: 2025-11-10  
**版本**: 1.0.0  
**状态**: 已完成基础功能，待集成 API
